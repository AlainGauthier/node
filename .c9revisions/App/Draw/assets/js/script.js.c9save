{"ts":1353343785338,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"$(function(){\r\n\r\n\t// This demo depends on the canvas element\r\n\tif(!('getContext' in document.createElement('canvas'))){\r\n\t\talert('Sorry, it looks like your browser does not support canvas!');\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// The URL of your web server (the port is set in app.js)\r\n\tvar url = 'http://localhost:8080';\r\n\r\n\tvar doc = $(document),\r\n\t\twin = $(window),\r\n\t\tcanvas = $('#paper'),\r\n\t\tctx = canvas[0].getContext('2d'),\r\n\t\tinstructions = $('#instructions');\r\n\t\r\n\t// Generate an unique ID\r\n\tvar id = Math.round($.now()*Math.random());\r\n\t\r\n\t// A flag for drawing activity\r\n\tvar drawing = false;\r\n\r\n\tvar clients = {};\r\n\tvar cursors = {};\r\n\r\n\tvar socket = io.connect(url);\r\n\t\r\n\tsocket.on('moving', function (data) {\r\n\t\t\r\n\t\tif(! (data.id in clients)){\r\n\t\t\t// a new user has come online. create a cursor for them\r\n\t\t\tcursors[data.id] = $('<div class=\"cursor\">').appendTo('#cursors');\r\n\t\t}\r\n\t\t\r\n\t\t// Move the mouse pointer\r\n\t\tcursors[data.id].css({\r\n\t\t\t'left' : data.x,\r\n\t\t\t'top' : data.y\r\n\t\t});\r\n\t\t\r\n\t\t// Is the user drawing?\r\n\t\tif(data.drawing && clients[data.id]){\r\n\t\t\t\r\n\t\t\t// Draw a line on the canvas. clients[data.id] holds\r\n\t\t\t// the previous position of this user's mouse pointer\r\n\t\t\t\r\n\t\t\tdrawLine(clients[data.id].x, clients[data.id].y, data.x, data.y);\r\n\t\t}\r\n\t\t\r\n\t\t// Saving the current client state\r\n\t\tclients[data.id] = data;\r\n\t\tclients[data.id].updated = $.now();\r\n\t});\r\n\r\n\tvar prev = {};\r\n\t\r\n\tcanvas.on('mousedown',function(e){\r\n\t\te.preventDefault();\r\n\t\tdrawing = true;\r\n\t\tprev.x = e.pageX;\r\n\t\tprev.y = e.pageY;\r\n\t\t\r\n\t\t// Hide the instructions\r\n\t\tinstructions.fadeOut();\r\n\t});\r\n\t\r\n\tdoc.bind('mouseup mouseleave',function(){\r\n\t\tdrawing = false;\r\n\t});\r\n\r\n\tvar lastEmit = $.now();\r\n\r\n\tdoc.on('mousemove',function(e){\r\n\t\tif($.now() - lastEmit > 30){\r\n\t\t\tsocket.emit('mousemove',{\r\n\t\t\t\t'x': e.pageX,\r\n\t\t\t\t'y': e.pageY,\r\n\t\t\t\t'drawing': drawing,\r\n\t\t\t\t'id': id\r\n\t\t\t});\r\n\t\t\tlastEmit = $.now();\r\n\t\t}\r\n\t\t\r\n\t\t// Draw a line for the current user's movement, as it is\r\n\t\t// not received in the socket.on('moving') event above\r\n\t\t\r\n\t\tif(drawing){\r\n\t\t\t\r\n\t\t\tdrawLine(prev.x, prev.y, e.pageX, e.pageY);\r\n\t\t\t\r\n\t\t\tprev.x = e.pageX;\r\n\t\t\tprev.y = e.pageY;\r\n\t\t}\r\n\t});\r\n\r\n\t// Remove inactive clients after 10 seconds of inactivity\r\n\tsetInterval(function(){\r\n\t\t\r\n\t\tfor(ident in clients){\r\n\t\t\tif($.now() - clients[ident].updated > 10000){\r\n\t\t\t\t\r\n\t\t\t\t// Last update was more than 10 seconds ago. \r\n\t\t\t\t// This user has probably closed the page\r\n\t\t\t\t\r\n\t\t\t\tcursors[ident].remove();\r\n\t\t\t\tdelete clients[ident];\r\n\t\t\t\tdelete cursors[ident];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t},10000);\r\n\r\n\tfunction drawLine(fromx, fromy, tox, toy){\r\n\t\tctx.moveTo(fromx, fromy);\r\n\t\tctx.lineTo(tox, toy);\r\n\t\tctx.stroke();\r\n\t}\r\n\r\n});"]],"start1":0,"start2":0,"length1":0,"length2":2672}]],"length":2672}
{"contributors":[],"silentsave":false,"ts":1353343870506,"patch":[[{"diffs":[[0,"http"],[1,"s"],[0,"://"],[-1,"localhost:8080"],[1,"c9.io/jjryag/node/workspace/App/Draw/"],[0,"';\r\n"]],"start1":288,"start2":288,"length1":25,"length2":49}]],"length":2696,"saved":false}
{"ts":1353343877480,"patch":[[{"diffs":[[0,"tions');"],[1," "],[0,"\r\n\t\r\n\t//"]],"start1":474,"start2":474,"length1":16,"length2":17}]],"length":2697,"saved":false}
{"contributors":[],"silentsave":false,"ts":1353350388294,"patch":[[{"diffs":[[0,"9.io"],[-1,"/jjryag/node/workspace/App/Draw/"],[1,":8080"],[0,"';\r\n"]],"start1":297,"start2":297,"length1":40,"length2":13}]],"length":2670,"saved":false}
{"ts":1353351331259,"patch":[[{"diffs":[[0,"s://"],[-1,"c9.io:8080'"],[1,"' + process.env.IP + ':' + process.env.PORT"],[0,";\r\n\r"]],"start1":292,"start2":292,"length1":19,"length2":51}]],"length":2702,"saved":false}
{"contributors":[],"silentsave":false,"ts":1353351999859,"patch":[[{"diffs":[[0,".IP + ':' + "],[1,"Number("],[0,"process.env."]],"start1":311,"start2":311,"length1":24,"length2":31},{"diffs":[[0,"env.PORT"],[1,")"],[0,";\r\n\r\n\tva"]],"start1":338,"start2":338,"length1":16,"length2":17}]],"length":2710,"saved":false}
{"ts":1353352036237,"patch":[[{"diffs":[[0,"P + "],[-1,"':' + Number("],[0,"proc"]],"start1":313,"start2":313,"length1":21,"length2":8},{"diffs":[[0,"env.PORT"],[-1,")"],[0,";\r\n\r\n\tva"]],"start1":325,"start2":325,"length1":17,"length2":16}]],"length":2696,"saved":false}
{"ts":1353352150232,"patch":[[{"diffs":[[0,"http"],[-1,"s"],[0,"://"],[-1,"' + process.env.IP + process.env.PORT"],[1,"node.jjryag.c9.io'"],[0,";\r\n\r"]],"start1":288,"start2":288,"length1":49,"length2":29}]],"length":2676,"saved":false}
{"ts":1353352402450,"patch":[[{"diffs":[[0," = '"],[-1,"http://node.jjryag.c9.io"],[1,"0.0.0.0"],[0,"';\r\n"]],"start1":284,"start2":284,"length1":32,"length2":15}]],"length":2659,"saved":false}
{"ts":1353352435186,"patch":[[{"diffs":[[0," url = '"],[1,"https://"],[0,"0.0.0.0'"]],"start1":280,"start2":280,"length1":16,"length2":24}]],"length":2667,"saved":false}
{"ts":1353352491070,"patch":[[{"diffs":[[0," = 'http"],[-1,"s"],[0,"://0.0.0"]],"start1":284,"start2":284,"length1":17,"length2":16}]],"length":2666,"saved":false}
{"ts":1353352768765,"patch":[[{"diffs":[[0,"l = "],[-1,"'http://0.0.0.0'"],[1," process.env.IP"],[0,";\r\n\r"]],"start1":283,"start2":283,"length1":24,"length2":23}]],"length":2665,"saved":false}
{"ts":1353352781814,"patch":[[{"diffs":[[0," url =  "],[1,"+"],[0,"process."]],"start1":280,"start2":280,"length1":16,"length2":17}]],"length":2666,"saved":false}
{"contributors":[],"silentsave":false,"ts":1353431891446,"patch":[[{"diffs":[[0,"s.env.IP"],[1," + \":\" + process.env.PORT"],[0,";\r\n\r\n\tva"]],"start1":295,"start2":295,"length1":16,"length2":41}]],"length":2691,"saved":false}
{"contributors":[],"silentsave":false,"ts":1353435966199,"patch":[[{"diffs":[[0," url =  "],[-1,"+"],[0,"process."]],"start1":280,"start2":280,"length1":17,"length2":16},{"diffs":[[0,"+ \":\" + "],[1,"Number("],[0,"process."]],"start1":303,"start2":303,"length1":16,"length2":23},{"diffs":[[0,"env.PORT"],[1,")"],[0,";\r\n\r\n\tva"]],"start1":326,"start2":326,"length1":16,"length2":17}]],"length":2698,"saved":false}
{"ts":1353436004010,"patch":[[{"diffs":[[0," =  "],[-1,"process.env.IP"],[1,"'0.0.0.0'"],[0," + \""]],"start1":284,"start2":284,"length1":22,"length2":17}]],"length":2693,"saved":false}
{"ts":1353436157532,"patch":[[{"diffs":[[0,".0' "],[-1,"+ \":\" + Number(process.env.PORT)"],[0,";\r\n\r"]],"start1":294,"start2":294,"length1":40,"length2":8}]],"length":2661,"saved":false}
